#+TITLE:       Nginx HTTP2.0
#+AUTHOR:      武向东
#+EMAIL:       KongFu@Battleplane.local
#+DATE:        2016-06-30 Thu
#+URI:         /blog/2016/6/30/nginx-http2.0
#+KEYWORDS:    nginx,http
#+TAGS:        nginx,http
#+LANGUAGE:    en
#+OPTIONS:     H:3 num:nil toc:nil \n:nil ::t |:t ^:nil -:nil f:t *:t <:t
#+DESCRIPTION: Nginx HTTP2.0

Nginx 从1.9.5已经能够支持HTTP2.0，但是对Openssl版本有要求，下面是过程：

*** 环境准备：
#+BEGIN_SRC sh
$yum install gcc gcc-c++ autoconf automake zlib zlib-devel pcre-devel
#+END_SRC

*** 编译Nginx版本：
#+BEGIN_SRC sh
$wget http://nginx.org/download/nginx-1.11.1.tar.gz
$tar xf /nginx-1.10.0.tar.gz
$./configure \
--prefix=/etc/nginx\
--sbin-path=/usr/sbin/nginx \
--conf-path=/etc/nginx/nginx.conf \
--error-log-path=/var/log/nginx/error.log \
--http-log-path=/var/log/nginx/access.log \
--pid-path=/var/run/nginx.pid \
--lock-path=/var/run/nginx.lock \
--http-client-body-temp-path=/var/cache/nginx/client_temp \
--http-proxy-temp-path=/var/cache/nginx/proxy_temp \
--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \
--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \
--http-scgi-temp-path=/var/cache/nginx/scgi_temp \
--user=nginx \
--group=nginx \
--with-openssl=/usr/src/openssl-1.0.2h \
--with-http_ssl_module \
--with-http_realip_module \
--with-http_addition_module \
--with-http_sub_module \
--with-http_dav_module \
--with-http_flv_module \
--with-http_mp4_module \
--with-http_gunzip_module \
--with-http_gzip_static_module \
--with-http_random_index_module \
--with-http_secure_link_module \
--with-http_stub_status_module \
--with-http_auth_request_module \
--with-mail \
--with-debug \
--with-mail_ssl_module \
--with-file-aio \
--with-ipv6 \
--with-threads \
--with-stream \
--with-stream_ssl_module \
--with-http_slice_module \
--with-http_v2_module
$make && make install 
#+END_SRC

*** 修改配置并且运行
    1) 修改配置：
       #+BEGIN_SRC sh
       $修改配置文件：
	添加：listen 443 ssl http2;
             server_name x.17mei.cn;
	     #ssl on;
	     ssl_certificate /etc/cert1.pem;
	     ssl_certificate_key /etc/privkey1.pem;
       #+END_SRC
    2) 运行：
       1. 可执行文件在objs 目录下，直接可以使用。
       2. 运行过程例如：
       #+BEGIN_SRC sh
       $./nginx -c /etc/nginx/nginx.conf
       #+END_SRC

*** 效果：
    能够在浏览器审核中，看到Network->Protocol中有h2等关键字，说明http2已经成功。
@@html:<a href="http://o9l83saod.bkt.clouddn.com/http2.0.png" title="nginx http2.0, on Flickr"><img src="http://o9l83saod.bkt.clouddn.com/http2.0.png" alt="http2.0"></a>@@

